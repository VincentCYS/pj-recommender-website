{"ast":null,"code":"import _regeneratorRuntime from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/vincentchan/Documents/GitHub/online-shop/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/vincentchan/Documents/GitHub/online-shop/src/Components/Details/Details.js\";\nimport React, { Component } from \"react\";\nimport Button from \"@material-ui/core/Button\";\nimport AddShoppingCartIcon from \"@material-ui/icons/AddShoppingCart\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { addItemInCart } from \"../../Redux/Actions\";\nimport API from \"../../helpers/api.js\";\nimport Item from \"../Item/Item\";\nimport { connect } from \"react-redux\";\nimport Rating from \"react-star-rating-component\";\nvar USER_ID = 2;\n\nvar ConnectedDetails =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ConnectedDetails, _Component);\n\n  function ConnectedDetails(props) {\n    var _this;\n\n    _classCallCheck(this, ConnectedDetails);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ConnectedDetails).call(this, props));\n    _this.isCompMounted = false;\n    _this.state = {\n      relatedItems: [],\n      quantity: 1,\n      item: null,\n      rating: 0,\n      recent: [],\n      loading: false\n    };\n    return _this;\n  } // Gets product and its related items based on product ID.\n\n\n  _createClass(ConnectedDetails, [{\n    key: \"fetchProductUsingID\",\n    value: function () {\n      var _fetchProductUsingID = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(id) {\n        var _this2 = this;\n\n        var item;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.setState({\n                  loading: true\n                });\n                item = [];\n                API.get(\"/recipes\", {\n                  id: id\n                }).then(function (res) {\n                  if (res.data.rows.length) {\n                    item = res.data.rows[0];\n                    var date = new Date(item.createDate).toLocaleDateString();\n                    item.createDate = date;\n\n                    if (_this2.isCompMounted) {\n                      _this2.setState({\n                        item: item,\n                        quantity: 1,\n                        loading: false\n                      }, function () {\n                        _this2.getRating();\n\n                        _this2.createBrowseHistory();\n                      });\n                    }\n                  }\n                }).catch(function (err) {\n                  return console.log(err);\n                });\n                API.get(\"/findSimilarRecipe\", {\n                  rid: id\n                }).then(function (res) {\n                  if (res.data.rows.length) {\n                    var relatedItems = res.data.rows; // Make sure this component is still mounted before we set state..\n\n                    if (_this2.isCompMounted) {\n                      _this2.setState({\n                        relatedItems: relatedItems,\n                        // relatedItems: relatedItems.data.filter(x => x.id !== item.id),\n                        loading: false\n                      });\n                    }\n                  }\n                }).catch(function (err) {\n                  return console.log(err);\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function fetchProductUsingID(_x) {\n        return _fetchProductUsingID.apply(this, arguments);\n      }\n\n      return fetchProductUsingID;\n    }()\n  }, {\n    key: \"getRating\",\n    value: function getRating() {\n      var _this3 = this;\n\n      API.get(\"/rating\", {\n        rid: this.state.item.id,\n        uid: USER_ID\n      }).then(function (res) {\n        if (res.data.rows.length) {\n          _this3.setState({\n            rating: res.data.rows[0].rating\n          });\n        }\n      }).catch(function (err) {\n        return console.log(err);\n      });\n    }\n  }, {\n    key: \"createBrowseHistory\",\n    value: function createBrowseHistory() {\n      API.create(\"/browse_history\", {\n        rid: this.state.item.id,\n        uid: USER_ID\n      }).then(function (res) {}).catch(function (err) {\n        return console.log(err);\n      });\n    }\n  }, {\n    key: \"getRecentViewedRecipe\",\n    value: function getRecentViewedRecipe() {\n      var _this4 = this;\n\n      API.get(\"/recent_viewed_recipes\", {\n        uid: USER_ID\n      }).then(function (res) {\n        if (res.data.rows.length) {\n          var recent = res.data.rows; // Make sure this component is still mounted before we set state..\n\n          if (_this4.isCompMounted) {\n            _this4.setState({\n              recent: recent,\n              // relatedItems: relatedItems.data.filter(x => x.id !== item.id),\n              loading: false\n            });\n          }\n        }\n      }).catch(function (err) {\n        return console.log(err);\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState, snapshot) {\n      // If ID of product changed in URL, refetch details for that product\n      if (this.props.match.params.id !== prevProps.match.params.id) {\n        this.fetchProductUsingID(this.props.match.params.id);\n        this.getRating();\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.isCompMounted = true;\n      this.fetchProductUsingID(this.props.match.params.id);\n      this.getRecentViewedRecipe();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.isCompMounted = false;\n    }\n  }, {\n    key: \"rateRecipe\",\n    value: function rateRecipe(rating) {\n      var _this5 = this;\n\n      API.create(\"/rating\", {\n        rid: this.props.match.params.id,\n        uid: USER_ID,\n        rating: rating\n      }).then(function (res) {\n        if (res.result) {\n          console.log(\"===> rating\", rating);\n\n          _this5.setState({\n            rating: rating\n          });\n        }\n      }).catch(function (err) {\n        return console.log(err);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      console.log(this.state.recent);\n\n      if (this.state.loading) {\n        return React.createElement(CircularProgress, {\n          className: \"circular\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        });\n      }\n\n      if (!this.state.item) {\n        return null;\n      }\n\n      return React.createElement(\"div\", {\n        style: {\n          padding: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          width: '100%',\n          display: 'flex',\n          padding: 10,\n          flexDirection: 'row'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          marginBottom: 20,\n          marginTop: 10,\n          color: \"gray\",\n          fontSize: 20,\n          marginRight: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, this.state.item.name), React.createElement(Rating, {\n        style: {\n          flex: 1,\n          marginTop: 5,\n          width: \"100%\"\n        },\n        name: \"Rate\",\n        value: this.state.item.rating || 0\n        /* number of selected icon (`0` - none, `1` - first) */\n        ,\n        editing: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        style: {\n          display: \"flex\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        style: {\n          marginTop: 30,\n          marginBottom: 20,\n          color: \"gray\",\n          fontSize: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, \"Recipe Description\"), React.createElement(\"div\", {\n        style: {\n          marginLeft: 5,\n          maxHeight: 200,\n          fontSize: 13,\n          overflow: \"auto\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        style: {\n          fontSize: 18,\n          marginTop: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, \"Ingredients\", this.state.item.ingredient_list.split(\",\").map(function (v) {\n        return React.createElement(\"div\", {\n          style: {\n            fontSize: 18,\n            marginTop: 10\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213\n          },\n          __self: this\n        }, v + \"\\n\");\n      })), React.createElement(\"div\", {\n        style: {\n          fontSize: 18,\n          marginTop: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }, \"Steps\", this.state.item.detailStep.split(\".,\").map(function (v, i) {\n        return React.createElement(\"div\", {\n          style: {\n            fontSize: 18,\n            marginTop: 10\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220\n          },\n          __self: this\n        }, \"Step \".concat(i, \" \").concat(v, \"\\n\"));\n      })), React.createElement(\"div\", {\n        style: {\n          fontSize: 18,\n          marginTop: 40\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, \"Created Date : \", this.state.item.createDate), React.createElement(\"div\", {\n        style: {\n          fontSize: 18,\n          marginTop: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }, \"Calorie : \", this.state.item.calorie), React.createElement(\"div\", {\n        style: {\n          width: 100,\n          marginLeft: 20,\n          marginTop: 20,\n          display: \"flex\",\n          flexDirection: \"column\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, \"Your Rate\", React.createElement(Rating, {\n        style: {\n          flex: 1,\n          marginTop: 5,\n          width: \"100%\"\n        },\n        name: \"Rate\",\n        value: this.state.rating || 0\n        /* number of selected icon (`0` - none, `1` - first) */\n        ,\n        onStarClick: function onStarClick(nextValue) {\n          return _this6.rateRecipe(nextValue);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      })), JSON.stringify(this.state.relatedItems[0]) != \"{}\" && this.state.relatedItems.length ? React.createElement(\"div\", {\n        style: {\n          marginTop: 30,\n          marginBottom: 10,\n          color: \"gray\",\n          fontSize: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, \"Related Recipes\") : null, JSON.stringify(this.state.relatedItems[0]) != \"{}\" ? this.state.relatedItems.map(function (x) {\n        return React.createElement(Item, {\n          key: x.id,\n          item: x,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 266\n          },\n          __self: this\n        });\n      }) : null, React.createElement(\"div\", {\n        style: {\n          marginTop: 30,\n          marginBottom: 10,\n          color: \"gray\",\n          fontSize: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, \"Recent Viewed Recipes\"), this.state.recent.length ? this.state.recent.map(function (x) {\n        return React.createElement(Item, {\n          key: x.id,\n          item: x,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 283\n          },\n          __self: this\n        });\n      }) : null);\n    }\n  }]);\n\n  return ConnectedDetails;\n}(Component);\n\nvar Details = connect()(ConnectedDetails);\nexport default Details;","map":{"version":3,"sources":["/Users/vincentchan/Documents/GitHub/online-shop/src/Components/Details/Details.js"],"names":["React","Component","Button","AddShoppingCartIcon","CircularProgress","addItemInCart","API","Item","connect","Rating","USER_ID","ConnectedDetails","props","isCompMounted","state","relatedItems","quantity","item","rating","recent","loading","id","setState","get","then","res","data","rows","length","date","Date","createDate","toLocaleDateString","getRating","createBrowseHistory","catch","err","console","log","rid","uid","create","prevProps","prevState","snapshot","match","params","fetchProductUsingID","getRecentViewedRecipe","result","padding","width","display","flexDirection","marginBottom","marginTop","color","fontSize","marginRight","name","flex","marginLeft","maxHeight","overflow","ingredient_list","split","map","v","detailStep","i","calorie","nextValue","rateRecipe","JSON","stringify","x","Details"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Button from \"@material-ui/core/Button\";\nimport AddShoppingCartIcon from \"@material-ui/icons/AddShoppingCart\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { addItemInCart } from \"../../Redux/Actions\";\nimport API from \"../../helpers/api.js\";\nimport Item from \"../Item/Item\";\nimport { connect } from \"react-redux\";\nimport Rating from \"react-star-rating-component\";\n\nconst USER_ID = 2;\nclass ConnectedDetails extends Component {\n  constructor(props) {\n    super(props);\n\n    this.isCompMounted = false;\n\n    this.state = {\n      relatedItems : [],\n      quantity     : 1,\n      item         : null,\n      rating       : 0,\n      recent       : [],\n      loading      : false\n    };\n  }\n\n  // Gets product and its related items based on product ID.\n  async fetchProductUsingID(id) {\n    this.setState({ loading: true });\n    var item = [];\n    API.get(\"/recipes\", { id: id })\n      .then(res => {\n        if (res.data.rows.length) {\n              item            = res.data.rows[0];\n          var date            = new Date(item.createDate).toLocaleDateString();\n              item.createDate = date;\n          if (this.isCompMounted) {\n            this.setState(\n              {\n                item,\n                quantity : 1,\n                loading  : false\n              },\n              () => {\n                this.getRating();\n                this.createBrowseHistory();\n              }\n            );\n          }\n        }\n      })\n      .catch(err => console.log(err));\n\n    API.get(\"/findSimilarRecipe\", { rid: id })\n      .then(res => {\n        if (res.data.rows.length) {\n          var relatedItems = res.data.rows;\n          // Make sure this component is still mounted before we set state..\n          if (this.isCompMounted) {\n            this.setState({\n              relatedItems,\n              // relatedItems: relatedItems.data.filter(x => x.id !== item.id),\n              loading : false\n            });\n          }\n        }\n      })\n      .catch(err => console.log(err));\n  }\n\n  getRating() {\n    API.get(\"/rating\", { rid: this.state.item.id, uid: USER_ID })\n      .then(res => {\n        if (res.data.rows.length) {\n          this.setState({\n            rating : res.data.rows[0].rating\n          });\n        }\n      })\n      .catch(err => console.log(err));\n  }\n\n  createBrowseHistory() {\n    API.create(\"/browse_history\", {\n      rid : this.state.item.id,\n      uid : USER_ID\n    })\n      .then(res => {})\n      .catch(err => console.log(err));\n  }\n\n  getRecentViewedRecipe() {\n    API.get(\"/recent_viewed_recipes\", { uid: USER_ID })\n      .then(res => {\n        if (res.data.rows.length) {\n          var recent = res.data.rows;\n          // Make sure this component is still mounted before we set state..\n          if (this.isCompMounted) {\n            this.setState({\n              recent,\n              // relatedItems: relatedItems.data.filter(x => x.id !== item.id),\n              loading : false\n            });\n          }\n        }\n      })\n      .catch(err => console.log(err));\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    // If ID of product changed in URL, refetch details for that product\n    if (this.props.match.params.id !== prevProps.match.params.id) {\n      this.fetchProductUsingID(this.props.match.params.id);\n      this.getRating();\n    }\n  }\n\n  componentDidMount() {\n    this.isCompMounted = true;\n    this.fetchProductUsingID(this.props.match.params.id);\n    this.getRecentViewedRecipe();\n  }\n\n  componentWillUnmount() {\n    this.isCompMounted = false;\n  }\n\n  rateRecipe(rating) {\n    API.create(\"/rating\", {\n      rid : this.props.match.params.id,\n      uid : USER_ID,\n      rating\n    })\n      .then(res => {\n        if (res.result) {\n          console.log(\"===> rating\", rating);\n\n          this.setState({\n            rating : rating\n          });\n        }\n      })\n      .catch(err => console.log(err));\n  }\n\n  render() {\n    console.log(this.state.recent);\n\n    if (this.state.loading) {\n      return <CircularProgress className = \"circular\" />;\n    }\n\n    if (!this.state.item) {\n      return null;\n    }\n    return (\n      <div style = {{ padding: 10 }}>\n      <div style = {{width : '100%' ,display: 'flex', padding: 10, flexDirection : 'row' }}>\n      <div\n          style={{\n            marginBottom : 20,\n            marginTop    : 10,\n            color        : \"gray\",\n            fontSize     : 20,\n            marginRight : 20\n          }}\n        >\n          {this.state.item.name}\n          </div>\n\n          <Rating\n            style = {{ flex: 1, marginTop: 5, width: \"100%\" }}\n            name  = {\"Rate\"}\n            value = {\n              this.state.item.rating || 0\n            } /* number of selected icon (`0` - none, `1` - first) */\n            editing = {false}\n          />\n\n\n      </div>\n    \n        <div style = {{ display: \"flex\" }}>\n        \n          {/* <img src={this.state.item.imageUrls[0]} alt=\"\" width={250} height={250} style={{ borderRadius: \"5%\", objectFit: \"cover\" }} /> */}\n        </div>\n\n  \n\n        {/* Recipe description */}\n        <div\n          style={{\n            marginTop    : 30,\n            marginBottom : 20,\n            color        : \"gray\",\n            fontSize     : 20\n          }}\n        >\n          Recipe Description\n        </div>\n        <div\n          style={{\n            marginLeft : 5,\n            maxHeight  : 200,\n            fontSize   : 13,\n            overflow   : \"auto\"\n          }}\n        ></div>\n        <div style = {{ fontSize: 18, marginTop: 10 }}>\n          Ingredients\n          {this.state.item.ingredient_list.split(\",\").map(v => (\n            <div style = {{ fontSize: 18, marginTop: 10 }}>{v + \"\\n\"}</div>\n          ))}\n        </div>\n\n        <div style = {{ fontSize: 18, marginTop: 20 }}>\n        Steps\n          {this.state.item.detailStep.split(\".,\").map((v, i) => (\n            <div style = {{ fontSize: 18, marginTop: 10 }}>{`Step ${i} ${v}\\n`}</div>\n          ))}\n        </div>\n\n        <div style = {{ fontSize: 18, marginTop: 40 }}>\n          Created Date : {this.state.item.createDate}\n        </div>\n        <div style = {{ fontSize: 18, marginTop: 10 }}>\n          Calorie : {this.state.item.calorie}\n        </div>\n\n        <div\n          style={{\n            width         : 100,\n            marginLeft    : 20,\n            marginTop     : 20,\n            display       : \"flex\",\n            flexDirection : \"column\"\n          }}\n        >\n          Your Rate\n          <Rating\n            style = {{ flex: 1, marginTop: 5, width: \"100%\" }}\n            name  = {\"Rate\"}\n            value = {\n              this.state.rating || 0\n            } /* number of selected icon (`0` - none, `1` - first) */\n            onStarClick = {nextValue => this.rateRecipe(nextValue)}\n          />\n        </div>\n\n        {/* Relateditems */}\n        {JSON.stringify(this.state.relatedItems[0]) != \"{}\" &&  this.state.relatedItems.length ? (\n          <div\n            style={{\n              marginTop    : 30,\n              marginBottom : 10,\n              color        : \"gray\",\n              fontSize     : 20\n            }}\n          >\n            Related Recipes\n          </div>\n        ) : null}\n        {JSON.stringify(this.state.relatedItems[0]) != \"{}\"\n          ? this.state.relatedItems.map(x => {\n              return <Item key = {x.id} item = {x} />;\n            })\n          : null}\n\n        {/* Recent Viewed items */}\n        <div\n          style={{\n            marginTop    : 30,\n            marginBottom : 10,\n            color        : \"gray\",\n            fontSize     : 20\n          }}\n        >\n          Recent Viewed Recipes\n        </div>\n        {this.state.recent.length\n          ? this.state.recent.map(x => {\n              return <Item key = {x.id} item = {x} />;\n            })\n          : null}\n      </div>\n    );\n  }\n}\n\nlet Details = connect()(ConnectedDetails);\nexport default Details;\n"]},"metadata":{},"sourceType":"module"}